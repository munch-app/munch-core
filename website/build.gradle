ext.dockerTag = dockerRegistryUrl + rootProject.name + '/' + project.name + ':'

task publishWebsiteLocal {
  doLast {
    exec {
      commandLine "docker", "build",
        "-f", "Dockerfile.local",
        "-t", dockerTag + 'local', '.'
    }
  }
}

//task buildProduction {
//  doLast {
//    exec {
//      commandLine "docker", "build",
//        "-f", "Dockerfile.production",
//        "-t", dockerTag + 'production', '.'
//    }
//  }
//}

// Remember to comment out when doing major changes
// To prevent accidental push
task publishProduction {
  doLast {
    exec {
      commandLine "docker", "build",
        "-f", "Dockerfile.production",
        "-t", dockerTag + 'production', '.'
    }
    exec { commandLine "docker", "push", dockerTag + 'production' }
    exec {
      commandLine 'aws', 'ecs', 'update-service',
        '--cluster', 'munch-core',
        '--service', 'Website',
        '--force-new-deployment'
    }
  }
}

task publishStaging {
  doLast {
    exec {
      commandLine "docker", "build",
        "-f", "Dockerfile.staging",
        "-t", dockerTag + 'staging', '.'
    }
    exec { commandLine "docker", "push", dockerTag + 'staging' }
    exec {
      commandLine 'aws', 'ecs', 'update-service',
        '--cluster', 'munch-core',
        '--service', 'Website_Staging',
        '--force-new-deployment'
    }
  }
}
